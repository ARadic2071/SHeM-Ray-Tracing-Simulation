function mexCompile(recompile)
    files_exist = exist('bin/tracingMultiGenMex.mexa64', 'file');         
    if narging == 1
        recompile = true;
    end
    
    if ~files_exist && ~recompile
        return
    end
    
    % Create a directory for the compiled mex binaries
    if ~exits('bin', 'dir')
        mkdir('bin')
    end
    
    % Compile the main 3D ray tracing library
    mex -c -R2018a CFLAGS='$CFLAGS -Imtwister -Iatom_ray_tracing_library -Wall -pedantic -ffast-math' ...
        -outdir atom_ray_tracing_library ...
        atom_ray_tracing_library/atom_ray_tracing3D.c
    
    % Compile the 2D ray tracing library
    mex -c -R2018a CFLAGS='$CFLAGS -Imtwister -Iatom_ray_tracing_library -Wall -pedantic -ffast-math' ...
        -outdir atom_ray_tracing_library ...
        atom_ray_tracing_library/atom_ray_tracing2D.c
    
    % Compile the mtwister library
    mex -c -R2018a CFLAGS='$CFLAGS -std=c99 -Imtwister -Iatom_ray_tracing_library -Wall -pedantic -ffast-math' ...
        -outdir mtwister ...
        mtwister/mtwister.c
    
    % For stl pinhole plate and sample
    %mex -R2018a CFLAGS='$CFLAGS -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
    %    mexFiles/tracingMex.c ...
    %    mexFiles/extract_inputs.c ...
    %    atom_ray_tracing_library/atom_ray_tracing3D.o ...
    %    mtwister/mtwister.o
    %mex -R2018a CFLAGS='$CFLAGS -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
    %    mexFiles/tracingGenMex.c ...
    %    mexFiles/extract_inputs.c ...
    %    atom_ray_tracing_library/atom_ray_tracing3D.o ...
    %    mtwister/mtwister.o

    % For a simple model of the pinhole plate
    %mex -R2018a CFLAGS='$CFLAGS -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
    %    mexFiles/tracingMultiMex.c ...
    %    mexFiles/extract_inputs.c ...
    %    atom_ray_tracing_library/atom_ray_tracing3D.o ...
    %    mtwister/mtwister.o
    mex -R2018a CFLAGS='$CFLAGS -std=c99 -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
        -outdir bin ...
        mexFiles/tracingMultiGenMex.c ...
        mexFiles/extract_inputs.c ...
        atom_ray_tracing_library/atom_ray_tracing3D.o ...
        mtwister/mtwister.o

    % For distribution or trac scattering just off a sample
    %mex -R2018a CFLAGS='$CFLAGS -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
    %    mexFiles/distributionCalcMex.c ...
    %    mexFiles/extract_inputs.c ...
    %    atom_ray_tracing_library/atom_ray_tracing3D.o ...
    %    mtwister/mtwister.o
    
    % For 2D scattering calculations
    mex -R2018a CFLAGS='$CFLAGS -std=c99 -I mtwister -I atom_ray_tracing_library -Wall -pedantic -ffast-math' ...
        -outdir bin ...
        mexFiles/scatterRaysMex2D.c ...
        atom_ray_tracing_library/atom_ray_tracing2D.o ...
        mtwister/mtwister.o
        
    % A binning function I wrote.
    mex -outdir bin mexFiles/binMyWayMex.c CFLAGS='$CFLAGS -std=c99 -Wall -pedantic'
end

